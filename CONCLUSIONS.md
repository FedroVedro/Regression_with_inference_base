# Выводы по домашней работе №1

## Что было сделано

### 1. EDA и предобработка данных
Сначала я загрузил данные и посмотрел на них. Нашел несколько проблем:
- Были пропуски в столбцах mileage, engine, max_power и seats
- Нашлись дубликаты - около 1800 строк с одинаковыми признаками
- Некоторые столбцы были в формате строк, хотя там числа (например engine был "1248 CC")

Что я сделал:
- Заполнил пропуски медианами (посчитанными на train выборке)
- Удалил дубликаты - оставил первое вхождение
- Почистил столбцы mileage, engine, max_power от единиц измерения и привел к числам
- Удалил столбец torque, потому что с ним было сложно
- Удалил столбец name, так как там слишком много уникальных значений

После предобработки осталось 5840 строк вместо 6999.

### 2. Визуализации

Построил несколько графиков чтобы понять данные:
- Pairplot показал что есть связь между ценой и признаками year, max_power
- Тепловая карта корреляций показала что самая сильная связь у цены с max_power (0.69)
- Также сделал boxplot по типу коробки передач и количеству владельцев

Выводы из графиков:
- Чем новее машина - тем дороже
- Чем больше мощность - тем выше цена
- Чем больше пробег - тем дешевле
- Автомат дороже механики
- Машина от первого владельца дороже

### 3. Обучение моделей

Обучил несколько моделей по порядку:

**Модель 1: Линейная регрессия (только числовые признаки)**
- Train R²: 0.5923
- Test R²: 0.5941
- Модель работает стабильно, переобучения нет

**Модель 2: Lasso регрессия**
- С дефолтными параметрами результат такой же как у линейной
- С GridSearch подобрал лучший alpha = 1000, но результат почти не изменился
- Ни один вес не занулился, все признаки полезны

**Модель 3: ElasticNet**
- Лучшие параметры: alpha=1.67, l1_ratio=0.9
- Test R²: 0.5580
- Результат хуже чем у линейной регрессии

**Модель 4: Ridge с категориальными признаками**
- Добавил категориальные признаки через OneHotEncoder
- После кодирования получилось 23 признака
- Подобрал alpha = 4.64 через GridSearch
- **Train R²: 0.6597**
- **Test R²: 0.6427** ← лучший результат!
- Business метрика: 0.247 (24.7% предсказаний попадают в 10% от реальной цены)

## Результаты

### Лучшая модель: Ridge Regression с категориальными признаками

Метрики:
- R² на тесте: **0.6427**
- R² на кросс-валидации: 0.6219
- Business метрика: 24.7%

Самые важные признаки (по весам модели):
1. **max_power** - мощность двигателя (самый важный!)
2. **year** - год выпуска
3. **engine** - объем двигателя
4. **km_driven** - пробег
5. **mileage** - расход топлива

## Что дало наибольший прирост качества

1. **Добавление категориальных признаков** - это дало прирост с R²=0.59 до R²=0.64. Это самое важное улучшение!
2. **Удаление дубликатов** - помогло модели не переобучаться на повторяющихся данных
3. **Правильная предобработка** - заполнение пропусков, стандартизация
4. **Подбор гиперпараметров** через GridSearchCV - помог найти оптимальную регуляризацию

## Что не удалось и почему

1. **Не обработал столбец name** - там было слишком много уникальных значений (названия моделей машин). Можно было бы извлечь марку и модель отдельно, но это сложно и я решил просто удалить этот столбец.

2. **Не обработал столбец torque** - там был странный формат данных (разные единицы измерения, текст), не успел разобраться, просто удалил.

3. **Business метрика не очень высокая** - только 24.7% предсказаний попадают в 10% от реальной цены. Это значит что модель часто ошибается больше чем на 10%. Возможно нужно больше признаков или другие алгоритмы (например деревья решений).

4. **L1 регуляризация не занулила признаки** - я думал Lasso поможет отобрать признаки, но все 6 числовых признаков оказались важными.

## Оценка разработанного сервиса (Streamlit приложение)

### Что получилось хорошо:
- **Удобный интерфейс** - разделил на 3 вкладки (EDA, предсказание, веса). Не нужно скроллить много
- **Два способа ввода данных** - можно и вручную ввести, и CSV загрузить
- **Хорошие визуализации EDA** - гистограммы, boxplot, scatter plot и корреляционная матрица. Все понятно
- **Визуализация весов** - сразу видно какие признаки важные. График с зеленым/красным помогает понять влияние

### Что менее удачно:
- **Нет проверки входных данных** - если пользователь введет что-то странное, приложение может упасть
- **Графики EDA статичные** - они показывают только данные из train, нельзя посмотреть по-другому
- **Нет объяснения предсказаний** - непонятно почему модель предсказала такую цену для конкретной машины

### Ограничения и проблемы:
1. Модель работает только с данными из Индии (цены в рупиях)
2. Если пользователь введет признаки которых не было в обучении (например новый тип топлива), может быть ошибка
3. Приложение не проверяет корректность данных (например если ввести отрицательный пробег)
4. Business метрика низкая - в реальности многие предсказания будут неточными

### Что планирую улучшить:
1. Добавить валидацию входных данных
2. Добавить больше интерактивности в EDA (фильтры, выбор признаков)
3. Попробовать другие модели (например Random Forest или XGBoost)
4. Обработать столбцы name и torque чтобы использовать больше информации
5. Добавить объяснение предсказаний (например SHAP values)
6. Сделать дизайн покрасивее

## Общий вывод

В целом работа получилась неплохая. Модель предсказывает цены с R²=0.64, что нормально для такого датасета. Streamlit приложение работает и выглядит прилично. Главное что я понял - важно правильно обрабатывать данные и использовать все доступные признаки. Категориальные признаки дали большой прирост качества.

Для следующей части постараюсь улучшить приложение и добавить больше функциональности!

